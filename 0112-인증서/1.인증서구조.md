# X.509 인증서 구조

## 인코딩 레이어

```
[실제 정보]          Subject, Issuer, 유효기간, 공개키 등
     ↓
[ASN.1 DER]         바이너리 구조로 인코딩 (기계용)
     ↓
[Base64]            바이너리를 텍스트로 변환 (전송/저장용)
     ↓
[PEM]               헤더/푸터 추가
                    -----BEGIN CERTIFICATE-----
                    -----END CERTIFICATE-----
```

## ASN.1

**ASN.1 (Abstract Syntax Notation One)**은 데이터 구조를 정의하는 국제 표준 언어

- 1984년 ITU-T에서 제정
- 플랫폼/언어에 독립적인 데이터 표현 방식
- 인증서, SNMP, LDAP, 통신 프로토콜 등에서 사용

**DER (Distinguished Encoding Rules)**은 ASN.1 데이터를 바이너리로 인코딩하는 규칙
- 동일한 데이터는 항상 동일한 바이너리로 인코딩됨
- 서명 검증에 필수적 (같은 입력 → 같은 출력)

**X.509**는 ITU-T가 정의한 공개키 인증서의 국제 표준 형식
- ASN.1로 인증서 구조를 정의
- DER로 바이너리 인코딩
- SSL/TLS 인증서가 모두 X.509 형식

**Java 라이브러리**
- `java.util.Base64` - Base64 디코딩
- `java.security.cert.CertificateFactory` - DER 바이트를 파싱하여 인증서 객체 생성
- `java.security.cert.X509Certificate` - X.509 인증서 정보 접근 (Subject, Issuer, 유효기간 등)

## X.509 인증서 전체 구조

```
Certificate ::= SEQUENCE {
    tbsCertificate       TBSCertificate,        -- 서명 대상 데이터
    signatureAlgorithm   AlgorithmIdentifier,   -- 서명 알고리즘
    signatureValue       BIT STRING             -- 서명 값
}

TBSCertificate ::= SEQUENCE {
    version         [0]  Version DEFAULT v1,    -- 버전 (보통 v3)
    serialNumber         INTEGER,               -- 시리얼 번호
    signature            AlgorithmIdentifier,   -- 서명 알고리즘
    issuer               Name,                  -- 발급자 (CA)
    validity             Validity,              -- 유효기간
    subject              Name,                  -- 소유자
    subjectPublicKeyInfo SubjectPublicKeyInfo,  -- 공개키 정보
    extensions      [3]  Extensions OPTIONAL    -- 확장 필드 (v3)
}

Validity ::= SEQUENCE {
    notBefore            Time,                  -- 유효 시작일
    notAfter             Time                   -- 만료일
}

SubjectPublicKeyInfo ::= SEQUENCE {
    algorithm            AlgorithmIdentifier,   -- 키 알고리즘
    subjectPublicKey     BIT STRING             -- 공개키
}
```

## 인증서 체인

```
┌─────────────────────────────────────────────┐
│ 서버 인증서 (End-Entity)                     │
│ - Subject: *.example.com                    │
│ - Issuer: Intermediate CA                   │
│ - 서명: 중간 CA의 개인키로 서명됨              │
├─────────────────────────────────────────────┤
│ 중간 CA 인증서 (Intermediate)                │
│ - Subject: Intermediate CA                  │
│ - Issuer: Root CA                           │
│ - 서명: 루트 CA의 개인키로 서명됨              │
├─────────────────────────────────────────────┤
│ 루트 CA 인증서 (Root)                        │
│ - Subject: Root CA                          │
│ - Issuer: Root CA (자체 서명)                │
│ - 브라우저/OS에 신뢰 목록으로 내장됨           │
└─────────────────────────────────────────────┘
```

### 검증 과정

1. 서버 인증서의 서명을 중간 CA 공개키로 검증
2. 중간 CA 인증서의 서명을 루트 CA 공개키로 검증
3. 루트 CA가 신뢰 목록에 있는지 확인
